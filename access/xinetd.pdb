<patterndb version='4' pub_date='2013-09-04'>

<ruleset name='xinetd' id='942b5f01-8dce-42b0-b4c2-3d0a67bca3b3'>
	<patterns>
		<pattern>xinetd</pattern>
	</patterns>
	<rules>
		<rule provider="wernli@in2p3.fr" id='f307ef5e-8010-4937-80bc-13c763ae13c0'
			class='application'
			context-id='xinetd-${appacct.rsclass}-${appacct.rsid}'
			context-scope='process'>
			<patterns>
				<pattern>EXIT: @ESTRING:appacct.rsclass: status=@@NUMBER:appacct.status@ pid=@NUMBER:appacct.rsid@ duration=@ESTRING:appacct.duration:(@sec)</pattern>
			</patterns>
			<examples>
				<example>
					<test_message program="xinetd">EXIT: nrpe status=0 pid=18581 duration=0(sec)</test_message>
					<test_values>
						<test_value name="appacct.rsclass">nrpe</test_value>
						<test_value name="appacct.status">0</test_value>
						<test_value name="appacct.rsid">18581</test_value>
						<test_value name="appacct.duration">0</test_value>
						<test_value name="flowevt.src_ip">::ffff:134.158.108.120</test_value>
					</test_values>
				</example>
			</examples>
			<values>
				<!-- use value from correlated previous event -->
				<value name="flowevt.src_ip">${flowevt.src_ip}@1</value>
				<value name="appacct.name">$PROGRAM</value>
				<value name="appacct.fct">status</value>
			</values>
			<tags>
				<tag>appacct</tag>
			</tags>
		</rule>
		<rule provider="wernli@in2p3.fr" id='f307ef5e-8010-4937-80bc-13c763ae13c0'
			class='application'
			context-id='xinetd-${appacct.rsclass}-${appacct.rsid}'
			context-timeout='10'
			context-scope='process'>
			<patterns>
				<pattern>START: @ESTRING:appacct.rsclass: pid=@@NUMBER:appacct.rsid@ from=@IPvANY:flowevt.src_ip@</pattern>
			</patterns>
			<examples>
				<example>
					<test_message program="xinetd">START: nrpe pid=18581 from=::ffff:134.158.108.120</test_message>
					<test_values>
						<test_value name="appacct.rsclass">nrpe</test_value>
						<test_value name="appacct.rsid">18581</test_value>
						<test_value name="flowevt.src_ip">::ffff:134.158.108.120</test_value>
					</test_values>
				</example>
			</examples>
			<actions>
				<action trigger='timeout'>
					<message inherit-properties='TRUE'>
						<values>
							<value name="MESSAGE">patterndb: svc=${appacct.rsclass}; pid=${appacct.rsid}; src=${flowevt.src_ip}; msg=xinetd service timeout after 10s</value>
						</values>
						<tags>
							<tag>alert</tag>
							<tag>flowevt</tag>
							<tag>appacct</tag>
						</tags>
					</message>
				</action>
			</actions>
			<tags>
				<tag>flowevt</tag>
				<tag>appacct</tag>
			</tags>
		</rule>
	</rules>
</ruleset>

</patterndb>

<!-- vim:ft=xml:background=dark
		 -->
